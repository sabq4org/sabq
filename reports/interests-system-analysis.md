# ุชุญููู ูุธุงู ุงูุงูุชูุงูุงุช - Sabq AI CMS

## ูุธุฑุฉ ุนุงูุฉ ุนูู ุงููุธุงู

ูุธุงู ุงูุงูุชูุงูุงุช ูู Sabq AI CMS ูุตูู ููุนูู ูุน ููุนูู ูู ุงููุณุชุฎุฏููู:
- **ุงููุณุชุฎุฏููู ุงููุณุฌููู**: ุจูุงูุงุชูู ูุญููุธุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- **ุงููุณุชุฎุฏููู ุงูุถููู**: ุจูุงูุงุชูู ูุญููุธุฉ ูู localStorage

## ููููุฉ ุนูู ุงููุธุงู

### 1. ุญูุธ ุงูุงูุชูุงูุงุช

#### ุตูุญุฉ ุงูุชูุถููุงุช (`/welcome/preferences`)
```typescript
// ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
const response = await fetch('/api/user/preferences', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: userId,
    categoryIds: selectedCategoryIds,
    source: 'manual'
  }),
});

// ุญูุธ ูู localStorage
const user = JSON.parse(currentUserData);
user.interests = selectedCategoryIds;
localStorage.setItem('user', JSON.stringify(user));
```

#### API ุญูุธ ุงูุชูุถููุงุช (`/api/user/preferences`)
- ูุญูุธ ุงูุชุตูููุงุช ูู ุฌุฏูู `UserPreference` ูุน ุงูููุชุงุญ `selected_categories`
- ูุญูุธ ุฃูุถุงู ูู ููู JSON ููุณุฎุฉ ุงุญุชูุงุทูุฉ
- ูุฏุนู ุงููุฒุงููุฉ ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ู localStorage

### 2. ุฌูุจ ุงูุงูุชูุงูุงุช

#### ุตูุญุฉ ุงูููู ุงูุดุฎุตู (`/profile`)
```typescript
// ูููุณุชุฎุฏููู ุงููุณุฌููู
if (!user.id.startsWith('guest-')) {
  const interestsResult = await fetch(`/api/user/saved-categories?userId=${user.id}`);
  if (interestsResult.value?.success && interestsResult.value?.categoryIds?.length > 0) {
    // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
  }
}

// ูููุณุชุฎุฏููู ุงูุถููู
if (user.id.startsWith('guest-')) {
  if (user.preferences && user.preferences.length > 0) {
    // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู localStorage
  }
}

// ุฎูุงุฑ ุงุญุชูุงุทู ูููุณุชุฎุฏููู ุงููุณุฌููู
if (user.preferences && user.preferences.length > 0) {
  // ุงุณุชุฎุฏุงู localStorage ูุฎูุงุฑ ุงุญุชูุงุทู
}
```

#### API ุฌูุจ ุงูุชุตูููุงุช ุงููุญููุธุฉ (`/api/user/saved-categories`)
- ูุจุญุซ ุฃููุงู ูู `UserPreference` ูุน ุงูููุชุงุญ `selected_categories`
- ุฅุฐุง ูู ูุฌุฏุ ูุจุญุซ ูู `UserPreference` ูุน ุงูููุชุงุญ `interests`
- ูุญูู ุฃุณูุงุก ุงูุงูุชูุงูุงุช ุฅูู ูุนุฑูุงุช ุงูุชุตูููุงุช
- ูุนูุฏ ูุตูููุฉ ูู ูุนุฑูุงุช ุงูุชุตูููุงุช

### 3. ุนุฑุถ ุงูุงูุชูุงูุงุช

#### ุชุญููู ุงูุจูุงูุงุช ููุนุฑุถ
```typescript
const userCategories = allCategories
  .filter((cat: any) => interestsResult.value.categoryIds.includes(cat.id))
  .map((cat: any) => ({
    category_id: cat.id,
    category_name: cat.name || cat.name_ar,
    category_icon: cat.icon || '๐',
    category_color: cat.color || '#6B7280'
  }));
```

## ูุตุงุฏุฑ ุงูุจูุงูุงุช

### 1. ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูููุณุชุฎุฏููู ุงููุณุฌููู)
- **ุฌุฏูู**: `UserPreference`
- **ุงูููุชุงุญ**: `selected_categories`
- **ุงููููุฉ**: ูุตูููุฉ ูู ูุนุฑูุงุช ุงูุชุตูููุงุช
- **ูุซุงู**: `["1", "3", "5"]`

### 2. localStorage (ูููุณุชุฎุฏููู ุงูุถููู)
- **ุงูููุชุงุญ**: `user`
- **ุงููููุฉ**: ูุงุฆู ุงููุณุชุฎุฏู ูุน ุฎุงุตูุฉ `interests`
- **ูุซุงู**: `{ id: "guest-123", interests: ["1", "3", "5"] }`

### 3. ููู JSON ุงุญุชูุงุทู
- **ุงููููุน**: `data/user_preferences.json`
- **ุงูุบุฑุถ**: ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูู ุชูุถููุงุช ุงููุณุชุฎุฏููู

## ุชุฏูู ุงูุจูุงูุงุช

```
1. ุงููุณุชุฎุฏู ูุฎุชุงุฑ ุงูุชูุงูุงุช ูู /welcome/preferences
   โ
2. ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุนุจุฑ /api/user/preferences
   โ
3. ุญูุธ ูู localStorage
   โ
4. ูู ุตูุญุฉ ุงูููู ุงูุดุฎุตูุ ุฌูุจ ุงูุจูุงูุงุช ูู:
   - ูุงุนุฏุฉ ุงูุจูุงูุงุช (ูููุณุชุฎุฏููู ุงููุณุฌููู)
   - localStorage (ูููุณุชุฎุฏููู ุงูุถููู)
   - localStorage ูุฎูุงุฑ ุงุญุชูุงุทู
   โ
5. ุนุฑุถ ุงูุงูุชูุงูุงุช ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู
```

## ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

### 1. Timeout ููุทูุจุงุช
```typescript
const createTimeoutSignal = (ms: number) => {
  const controller = new AbortController();
  setTimeout(() => controller.abort(), ms);
  return controller.signal;
};
```

### 2. Promise.allSettled
- ูุณุชุฎุฏู `Promise.allSettled` ุจุฏูุงู ูู `Promise.all`
- ูุถูู ุนุฏู ุชููู ุงูุชุทุจูู ุฅุฐุง ูุดู ุฃุญุฏ ุงูุทูุจุงุช

### 3. ููู ุงูุชุฑุงุถูุฉ
```typescript
setUserStats({
  articlesRead: 5,
  interactions: 12,
  shares: 3
});
```

## ุงููุฒุงููุฉ ุจูู ุงููุตุงุฏุฑ

### 1. ุฃููููุฉ ุงููุตุงุฏุฑ
1. **ูุงุนุฏุฉ ุงูุจูุงูุงุช** (ูููุณุชุฎุฏููู ุงููุณุฌููู)
2. **localStorage** (ูููุณุชุฎุฏููู ุงูุถููู)
3. **localStorage ูุฎูุงุฑ ุงุญุชูุงุทู** (ูููุณุชุฎุฏููู ุงููุณุฌููู)

### 2. ุชุญุฏูุซ ุงูุจูุงูุงุช
- ุนูุฏ ุชุณุฌูู ุงูุฏุฎููุ ูุชู ุฏูุฌ ุงูุจูุงูุงุช ูู API ูุน localStorage
- ุนูุฏ ุญูุธ ุงูุชูุงูุงุช ุฌุฏูุฏุฉุ ูุชู ุงูุชุญุฏูุซ ูู ููุง ุงููุตุฏุฑูู

## ุงููุดุงูู ุงููุญุชููุฉ ูุญููููุง

### 1. ุชุฃุฎูุฑ ูู ุงููุฒุงููุฉ
**ุงููุดููุฉ**: ูุฏ ูุง ุชุธูุฑ ุงูุงูุชูุงูุงุช ููุฑุงู ุจุนุฏ ุญูุธูุง
**ุงูุญู**: ุงุณุชุฎุฏุงู `setTimeout` ูุชุญุฏูุซ ุงูุตูุญุฉ ุจุนุฏ ุงูุญูุธ

### 2. ุชุถุงุฑุจ ุงูุจูุงูุงุช
**ุงููุดููุฉ**: ุงุฎุชูุงู ุจูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ู localStorage
**ุงูุญู**: ุฅุนุทุงุก ุงูุฃููููุฉ ููุงุนุฏุฉ ุงูุจูุงูุงุช ูููุณุชุฎุฏููู ุงููุณุฌููู

### 3. ููุฏุงู ุงูุจูุงูุงุช
**ุงููุดููุฉ**: ููุฏุงู ุงูุจูุงูุงุช ุนูุฏ ูุณุญ localStorage
**ุงูุญู**: ุงูุงุญุชูุงุธ ุจูุณุฎุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ุงูุชุญุณููุงุช ุงูููุชุฑุญุฉ

### 1. ุฅุถุงูุฉ Cache
```typescript
// ุฅุถุงูุฉ cache ููุชุตูููุงุช
const categoriesCache = new Map();
```

### 2. ุชุญุณูู ุงูุฃุฏุงุก
```typescript
// ุงุณุชุฎุฏุงู React Query ุฃู SWR
const { data: categories } = useQuery('categories', fetchCategories);
```

### 3. ุฅุถุงูุฉ ูุคุดุฑุงุช ุงูุชุญููู
```typescript
const [loadingInterests, setLoadingInterests] = useState(false);
```

## ุงูุฎูุงุตุฉ

ูุธุงู ุงูุงูุชูุงูุงุช ูุนูู ุจุดูู ุตุญูุญ ููููุฑ:
- **ูุฑููุฉ**: ูุนูู ูุน ุงููุณุชุฎุฏููู ุงููุณุฌููู ูุงูุถููู
- **ููุซูููุฉ**: ูุญุชูุธ ุจูุณุฎ ุงุญุชูุงุทูุฉ ูุชุนุฏุฏุฉ
- **ุฃุฏุงุก**: ูุณุชุฎุฏู ุทูุจุงุช ูุชูุงุฒูุฉ ูุน timeout
- **ุชุฌุฑุจุฉ ูุณุชุฎุฏู**: ูุนุฑุถ ูุคุดุฑุงุช ุชุญููู ูููู ุงูุชุฑุงุถูุฉ

ุงููุดููุฉ ุงูุชู ูุงุฌููุง ุงููุณุชุฎุฏู ูุงูุช ุนูู ุงูุฃุฑุฌุญ ุจุณุจุจ ุชุฃุฎูุฑ ูู ุงููุฒุงููุฉุ ูุชู ุญููุง ุชููุงุฆูุงู ุจุนุฏ ุจุถุน ุซูุงูู. 