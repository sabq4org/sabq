# حل مشكلة حذف المستخدمين

## المشكلة
عند محاولة حذف مستخدم من لوحة التحكم، كان يظهر خطأ "حدث خطأ في الاتصال بالخادم" وفي السجلات كان يظهر:
```
DELETE /api/admin/users/[userId] 404
```

## السبب
لم يكن هناك endpoint لحذف المستخدمين. ملف `/api/admin/users/route.ts` كان يحتوي فقط على:
- GET: لجلب جميع المستخدمين
- POST: لإنشاء مستخدم جديد

ولكن لم يكن هناك دالة DELETE للتعامل مع حذف المستخدمين.

## الحل
تم إنشاء ملف جديد `/app/api/admin/users/[userId]/route.ts` يحتوي على:

### 1. GET - جلب مستخدم محدد
- يتطلب صلاحية `users.read`
- يرجع معلومات المستخدم مع دوره وعدد جلساته

### 2. PUT - تحديث مستخدم
- يتطلب صلاحية `users.update`
- يمكن تحديث: البريد الإلكتروني، الاسم، الدور، كلمة المرور

### 3. DELETE - حذف مستخدم
- يتطلب صلاحية `users.delete`
- يتضمن حمايات:
  - منع حذف المستخدم لحسابه الخاص
  - منع حذف آخر مدير في النظام
  - حذف جلسات المستخدم قبل حذف الحساب

## الميزات الإضافية
- جميع العمليات محمية بنظام الصلاحيات
- رسائل خطأ واضحة باللغة العربية
- معالجة شاملة للأخطاء المحتملة
- حماية من حذف آخر مدير في النظام

## كيفية الاستخدام
```javascript
// حذف مستخدم
DELETE /api/admin/users/{userId}
Headers: {
  'Authorization': 'Bearer {token}'
}

// تحديث مستخدم
PUT /api/admin/users/{userId}
Headers: {
  'Authorization': 'Bearer {token}'
}
Body: {
  email?: string,
  name?: string,
  password?: string,
  roleId?: string
}

// جلب مستخدم محدد
GET /api/admin/users/{userId}
Headers: {
  'Authorization': 'Bearer {token}'
}
```

## النتيجة
الآن يمكن للمدراء حذف المستخدمين من لوحة التحكم بنجاح مع حمايات مناسبة. 