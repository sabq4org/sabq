# ุฏููู ุญูุงูุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ูุธุฑุฉ ุนุงูุฉ

ุชู ุชุทุจูู ูุธุงู ุญูุงูุฉ ูุชุนุฏุฏ ุงูุทุจูุงุช ูููุน ุญุฐู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุดูู ุบูุฑ ููุตูุฏ ุฃู ูุชุนูุฏ.

## ๐ ุทุจูุงุช ุงูุญูุงูุฉ ุงููุทุจูุฉ

### 1. ุญูุงูุฉ ุนูู ูุณุชูู Prisma Schema
- ุฌููุน ุงูุนูุงูุงุช ุชุณุชุฎุฏู `onDelete: NoAction` ูููุน ุงูุญุฐู ุงููุชุณูุณู
- ูุฐุง ูุถูู ุนุฏู ุญุฐู ุงูุณุฌูุงุช ุงููุฑุชุจุทุฉ ุชููุงุฆูุงู

### 2. ุญูุงูุฉ ุนูู ูุณุชูู Prisma Client
- ุชู ุฅุถุงูุฉ middleware ูุนุชุฑุถ ุฌููุน ุนูููุงุช ุงูุญุฐู
- ุงูุฌุฏุงูู ุงููุญููุฉ ุจุงููุงูู:
  - `users` - ุงููุณุชุฎุฏููู
  - `articles` - ุงูููุงูุงุช
  - `categories` - ุงูุชุตูููุงุช
  - `comments` - ุงูุชุนูููุงุช
  - `loyalty_points` - ููุงุท ุงูููุงุก
  - `activity_logs` - ุณุฌูุงุช ุงููุดุงุท

### 3. ุญูุงูุฉ ุนูู ูุณุชูู API Routes
- Middleware ููุญุต ุฌููุน ุทูุจุงุช DELETE
- ูุฑูุถ ุงูุทูุจุงุช ุนูู ุงูุฌุฏุงูู ุงููุญููุฉ ูุน ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

### 4. ุญูุงูุฉ ุนูู ูุณุชูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
```sql
-- ุฅูุดุงุก ูุณุชุฎุฏู ูููุฑุงุกุฉ ููุท
CREATE USER 'readonly_user'@'%' IDENTIFIED BY 'strong_password';
GRANT SELECT ON j3uar_sabq_ai.* TO 'readonly_user'@'%';

-- ุฅุฒุงูุฉ ุตูุงุญูุงุช DELETE ูู ุงููุณุชุฎุฏู ุงูุญุงูู (ุงุฎุชูุงุฑู)
REVOKE DELETE ON j3uar_sabq_ai.* FROM 'current_user'@'%';
```

## ๐ ุชูุนูู ุงูุญูุงูุฉ

### 1. ุฅุถุงูุฉ ูุชุบูุฑุงุช ุงูุจูุฆุฉ
```env
# ูู ููู .env.local ุฃู .env
ENABLE_DB_PROTECTION=true

# ูููุณุฎ ุงูุงุญุชูุงุทู
BACKUP_SCHEDULE="0 2 * * *"  # ููููุงู ูู ุงูุณุงุนุฉ 2 ุตุจุงุญุงู
BACKUP_RETENTION_DAYS=7
```

### 2. ุชุดุบูู ุงููุณุฎ ุงูุงุญุชูุงุทู ุงููุฏูู
```bash
# ูุณุฎุฉ ุงุญุชูุงุทูุฉ ูุงููุฉ
npm run backup:full

# ูุณุฎุฉ ุงุญุชูุงุทูุฉ ููุฌุฏุงูู ุงููููุฉ ููุท
npm run backup:critical

# ุชูุธูู ุงููุณุฎ ุงููุฏููุฉ
npm run backup:clean
```

### 3. ุฅุถุงูุฉ ุฃูุงูุฑ package.json
```json
{
  "scripts": {
    "backup:full": "ts-node scripts/backup-database.ts",
    "backup:critical": "ts-node -e \"require('./scripts/backup-database').backupCriticalTables()\"",
    "backup:clean": "ts-node -e \"require('./scripts/backup-database').cleanOldBackups()\""
  }
}
```

## ๐ ูุฑุงูุจุฉ ูุญุงููุงุช ุงูุญุฐู

ุฌููุน ูุญุงููุงุช ุงูุญุฐู ูุชู ุชุณุฌูููุง ูู:
1. Console logs ูุน timestamp
2. ุฌุฏูู `activity_logs` (ุฅุฐุง ูุงู ูุชุงุญุงู)
3. ูููู ุฅุถุงูุฉ ุชูุจููุงุช ุนุจุฑ ุงูุจุฑูุฏ ุฃู Slack

## ๐ง ุงุณุชุซูุงุกุงุช ุงูุญูุงูุฉ

### ุงูุฌุฏุงูู ุงููุณููุญ ุจุงูุญุฐู ูููุง (ุจุดุฑูุท):
- `interactions` - ุงูุชูุงุนูุงุช ุงููุฏููุฉ
- `analytics_data` - ุงูุจูุงูุงุช ุงูุชุญููููุฉ ุงููุฏููุฉ  
- `email_logs` - ุณุฌูุงุช ุงูุจุฑูุฏ ุงููุฏููุฉ

### ุฅุถุงูุฉ ุงุณุชุซูุงุก ุฌุฏูุฏ:
```typescript
// ูู lib/database-protection.ts
const PARTIALLY_PROTECTED_TABLES = [
  'table_name', // ุฅุถุงูุฉ ุงูุฌุฏูู ููุง
];
```

## ๐จ ูู ุญุงูุฉ ุงูุทูุงุฑุฆ

### ุฅููุงู ุงูุญูุงูุฉ ูุคูุชุงู:
```env
ENABLE_DB_PROTECTION=false
```

### ุงุณุชุนุงุฏุฉ ูู ูุณุฎุฉ ุงุญุชูุงุทูุฉ:
```bash
# ูู ุถุบุท ุงููุณุฎุฉ
gunzip backups/backup_j3uar_sabq_ai_2024-01-15.sql.gz

# ุงุณุชุนุงุฏุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช
mysql -h host -u user -p database < backups/backup_j3uar_sabq_ai_2024-01-15.sql
```

## ๐ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู Soft Delete**: ุจุฏูุงู ูู ุญุฐู ุงูุณุฌูุงุชุ ุฃุถู ุญูู `deletedAt`
2. **ุฃุฑุดู ุงูุจูุงูุงุช ุงููุฏููุฉ**: ุงููู ุงูุจูุงูุงุช ุงููุฏููุฉ ูุฌุฏุงูู ุฃุฑุดูู
3. **ุฑุงุฌุน ุงูุณุฌูุงุช ุฏูุฑูุงู**: ุชุญูู ูู `activity_logs` ูุฃู ูุญุงููุงุช ูุดุจููุฉ
4. **ุงุฎุชุจุฑ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**: ุชุฃูุฏ ูู ุฅููุงููุฉ ุงุณุชุนุงุฏุฉ ุงูุจูุงูุงุช
5. **ูุซูู ุฃู ุชุบููุฑุงุช**: ุณุฌู ุฃู ุชุนุฏููุงุช ุนูู ูุธุงู ุงูุญูุงูุฉ

## ๐ ูุตุงุฆุญ ุฃูููุฉ ุฅุถุงููุฉ

1. **ุชุดููุฑ ุงููุณุฎ ุงูุงุญุชูุงุทูุฉ**:
```bash
# ุชุดููุฑ ุงููุณุฎุฉ
openssl enc -aes-256-cbc -salt -in backup.sql -out backup.sql.enc

# ูู ุงูุชุดููุฑ
openssl enc -d -aes-256-cbc -in backup.sql.enc -out backup.sql
```

2. **ุชุฎุฒูู ุงููุณุฎ ุฎุงุฑุฌูุงู**: ุงุณุชุฎุฏู S3 ุฃู Google Cloud Storage

3. **ูุฑุงุฌุนุฉ ุงูุตูุงุญูุงุช**: ุชุญูู ุฏูุฑูุงู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

4. **ุชูุนูู Binary Logging**: ูุชุชุจุน ุฌููุน ุงูุชุบููุฑุงุช ูู MySQL

## ๐ ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ุฃู ูุดุงูู ุฃู ุงุณุชูุณุงุฑุงุช:
1. ุฑุงุฌุน ุณุฌูุงุช ุงููุธุงู
2. ุชุญูู ูู ุฑุณุงุฆู ุงูุฎุทุฃ ูู Console
3. ุชูุงุตู ูุน ูุฑูู ุงูุฏุนู ุงูููู 